<!DOCTYPE html><html><head><title>Space Invaders</title><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui=1"><meta charset="UTF-8"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="description" content=""><link rel="manifest" href="manifest.json"><link rel="icon" type="image/png" href="icon64.png"><link rel="apple-touch-icon" sizes="180x180" href="icon180.png"><link rel="icon" type="image/png" sizes="32x32" href="icon32.png"><link rel="icon" type="image/png" sizes="16x16" href="icon16.png"><style>html,body {
  margin: 0;
  padding: 0;
  background-color: #000;
  overflow:hidden;
  font-family: Verdana;
}
.noselect {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
#canvaswrapper {
  text-align: center ;
}
</style><style>@font-face { font-family: "BitCell" ; src: url("fonts/BitCell.ttf") format("truetype"); }</style><script>window.fonts = ["BitCell"]</script></head><body class="noselect custom-cursor" oncontextmenu="return false;"><div id="canvaswrapper"></div><script type="text/javascript">var resources = {"images":[{"file":"bullet.png","version":1,"properties":{"frames":1,"fps":5}},{"file":"icon.png","version":34,"properties":{"frames":1,"fps":5}},{"file":"laser.png","version":14,"properties":{"frames":1,"fps":5}},{"file":"left.png","version":14,"properties":{"frames":1,"fps":5}},{"file":"right.png","version":11,"properties":{"frames":1,"fps":5}},{"file":"shield.png","version":15,"properties":{"frames":1,"fps":5}},{"file":"space.png","version":6,"properties":{"frames":1,"fps":5}}],"assets":[],"maps":{"controls":"{\"width\":24,\"height\":15,\"block_width\":16,\"block_height\":16,\"sprites\":[0,\"left\",\"right\",\"space\"],\"data\":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}"}};
var graphics = "M1";

</script><script type="text/javascript">var orientation = 'landscape' ;
var aspect = '2x1' ;
window.skip_service_worker = true;
window.exported_project = true;
</script><script src="microengine.js"></script></body><script id="code" type="text/x-microscript">

Bullets = class
  constructor = function(x, y)
    this.x = x
    this.y = y
  end

  hp = 10
  velocity = 2

  move = function()
    y += velocity
  end

  hit = function(damage)
    hp -= damage
  end
end




getInput = function(key)
  return isKeyboardInput(key)
    or isTouchInput(key)
end

isKeyboardInput = function(key)
  return keyboard[key]
end

isTouchInput = function(key)
  return touch.touching and controls.isAt(toLower(key), touch.x, touch.y)
end


keybindings = object
  left = "LEFT"
  right = "RIGHT"
  fire = "SPACE"
end

init = function()
  level_colors = ["rgb(0,0,92)", 
    "rgb(92,0,92)", 
    "rgb(32,0,0)", 
    "rgb(0,64,32)", 
    "rgb(0,0,0)"]
  level = 0
  score = 0
  border = 2
  x = 0
  y = -screen.height / 2 + border + sprites["laser"].height
  bullets = []

  shields = []
  local shield = new Shields(-100, -50)
  shields.push(shield)
  local shield = new Shields(-35, -50)
  shields.push(shield)
  local shield = new Shields(35, -50)
  shields.push(shield)
  local shield = new Shields(100, -50)
  shields.push(shield)
  
  controls = new Map(maps.controls)
  print(controls)

  starttime = system.time()
end

update = function()
  local LeftPressed = getInput(keybindings.left)
  local RightPressed = getInput(keybindings.right)
  local FirePressed = getInput(keybindings.fire)

  if LeftPressed then 
    x = x - 2
    x = max(x, -screen.width / 2 + sprites["laser"].width + border)
  end
  if RightPressed then 
    x = x + 2 
    x = min(x, screen.width / 2 - sprites["laser"].width - border)
  end
  
  if FirePressed then
    stoptime = system.time()
    if (stoptime - starttime >= 250) then
      starttime = system.time()
      local bullet = new Bullets(x, y)
      bullets.push(bullet)
      audio.beep("loop 1 sine duration 50 volume 100 C6 duration 50 volume 100 G7 end")
    end
  end
end

draw = function()
  screen.fillRect(0,0,screen.width,screen.height,"rgb(192, 192, 192)")
  screen.fillRoundRect(0, 0,screen.width-border,screen.height-border,5,level_colors[level])
  
  screen.drawText(score,150,86,20,"#FFF")

  for s in shields
    screen.drawSprite(s.name, s.x, s.y, 40)
  end
  
  screen.drawSprite("laser", x, y, 20)
  
  controls.draw()

  for b in bullets
    b.move()
    screen.drawSprite("bullet", b.x, b.y, 2)
  end

  d = bullets.length
  while d > 0
    if bullets[d - 1].y > screen.height / 2 - border then
      bullets.removeAt(d - 1)
    else
      for s in shields
        if abs(bullets[d - 1].y - s.y) < 4 and abs(bullets[d - 1].x - s.x) < 20 then
          bullets.removeAt(d - 1)
        end
      end
    end
    d -= 1
  end

end

Map = class
  constructor = function(mapFile)
    this.mapFile = mapFile
    this.x = 0
    this.y = 0
    this.width = mapFile.width
    this.blockWidth = mapFile.block_width
    this.height = mapFile.height
    this.blockHeight = mapFile.block_height
  end
  
  draw = function()
    screen.drawMap(this.mapFile,this.x, this.y, this.width* this.blockWidth, this.height*this.blockHeight)
  end
  
  isAt = function(sprite, x, y)
    local indexX = floor((x + (this.width * this.blockWidth)/2) / this.blockWidth)
    local indexY = floor((y + (this.height * this.blockHeight)/2) / this.blockHeight)

    local name = this.mapFile.get(indexX, indexY)
    local colonIndex = name.indexOf(":")

    if colonIndex > 0 then
      name = name.substring(0, colonIndex)
    end

    return  (name == sprite) 
  end
  
  get = function(x, y)
    local coords = getMapCoords(x, y)

    local name = this.mapFile.get(coords.x, coords.y)
    local colonIndex = name.indexOf(":")

    if colonIndex > 0 then
      name = name.substring(0, colonIndex)
    end

    return name
  end
  
  getMapCoords = function(x, y)
    
    local indexX = floor((x + (this.width * this.blockWidth)/2) / this.blockWidth)
    local indexY = floor((y + (this.height * this.blockHeight)/2) / this.blockHeight)
    
    return new Point(indexX, indexY)
  end
  
  replace = function(x, y, spriteName)
    local coords = getMapCoords(x, y)
    
    this.mapFile.set(coords.x, coords.y, spriteName)
  end
  
  clearAt = function(x, y)
    replace(x, y, "")
  end
  
  count = function(spriteName)
    local count = 0
    for x = 0 to this.width
      for y = 0 to this.height
        if this.mapFile.get(x, y) == spriteName then
          count += 1
        end
      end
    end
    
    return count
  end
end

Shields = class
  constructor = function(x, y, name="shield")
    this.x = x
    this.y = y
    this.name = name
  end

  hp = 10

  hit = function(damage)
    hp -= damage
  end
end



toLower = function(text)
  letters = object
    A = "a"
    B = "b"
    C = "c"
    D = "d"
    E = "e"
    F = "f"
    G = "g"
    H = "h"
    I = "i"
    J = "j"
    K = "k"
    L = "l"
    M = "m"
    N = "n"
    O = "o"
    P = "p"
    Q = "q"
    R = "r"
    S = "s"
    T = "t"
    U = "u"
    V = "v"
    W = "w"
    X = "x"
    Y = "y"
    Z = "z"
  end
  
  return changeChars(text, letters)
end

toUpper = function(text)
  letters = object
    a = "A"
    b = "B"
    c = "C"
    d = "D"
    e = "E"
    f = "F"
    g = "G"
    h = "H"
    i = "I"
    j = "J"
    k = "K"
    l = "L"
    m = "M"
    n = "N"
    o = "O"
    p = "P"
    q = "Q"
    r = "R"
    s = "S"
    t = "T"
    u = "U"
    v = "V"
    w = "W"
    x = "X"
    y = "Y"
    z = "Z"
  end
  
  return changeChars(text, letters)
end

changeChars = function(text, charPairs)
  local lowerText = ""

  for i = 0 to text.length-1
    local l = text[i]
    lowerText += if charPairs[l] then charPairs[l] else l end
  end
  
  return lowerText
end

</script></html>